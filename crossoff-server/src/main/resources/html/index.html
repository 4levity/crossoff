<!DOCTYPE html>
<html><head><title>crossoff</title><script>
    function loadBy(orderBy) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                showTickets(JSON.parse(this.responseText));
            }
        };
        request.open("GET","/tickets/?sort=" + orderBy,true);
        request.send(null);
    }
    function showTickets(tickets) {
        var ticketList = "<table style='border-collapse:collapse'><thead style='background: lightgray'><tr>"
                + "<td onclick=loadBy('code')>Code&nbsp;</td>"
                + "<td onclick=loadBy('ticketholder')>Ticketholder&nbsp;</td>"
                + "<td onclick=loadBy('ticketType')>Ticket Type&nbsp;</td>"
                + "<td onclick=loadBy('description')>Description&nbsp;</td>"
                + "<td onclick=loadBy('scanned')>Scanned</td>"
                + "</tr></thead><tbody>";
        var row;
        var scanned = 0;
        var tdStyle = 'border-bottom:1px solid black';
        for (row = 0; row < tickets.length; row++) {
            var ticket = tickets[row];
            var scanText;
            var tdCodeStyle;
            if (ticket.scanned) {
                // convert UTC seconds.milliseconds timestamp into browser-local time string
                scanText = new Date(1000 * ticket.scanned).toLocaleString();
                scanned++;
                tdCodeStyle = tdStyle + ";text-decoration:line-through";
            } else {
                scanText = "never";
                tdCodeStyle = tdStyle;
            }
            ticketList += "<tr onclick=document.location='edit.html?code=" + ticket.code + "'>" +
                    "<td style='font-family:monospace;" + tdCodeStyle + "'>" + ticket.code + "&nbsp;</td>" +
                    "<td style='" + tdCodeStyle + "'>" + (ticket.ticketholder || '')  + "&nbsp;</td>" +
                    "<td style='" + tdStyle + "'>" + (ticket.ticketType || 'UNSPECIFIED')  + "&nbsp;</td>" +
                    "<td style='" + tdStyle + "'>" + ticket.description +  "&nbsp;</td>" +
                    "<td style='" + tdStyle + "'>" + scanText + "</td>"
                    + "</tr>";
        }
        ticketList += "</tbody></table>";
        document.getElementById("summary").innerHTML = "Scanned " + scanned + " of " + tickets.length + " tickets";
        document.getElementById("tickets").innerHTML = ticketList;
    }
</script></head>
<body onload=loadBy("description")>
<h3><a href="/">Crossoff</a> - Tickets</h3>
<div id=summary></div>
<div id=tickets></div>
<br/><a href=admin.html>[ go to admin / import page ]</a>
</body></html>
